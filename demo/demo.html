<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>图片裁剪demo</title>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge">
	<style type="text/css">
		
		body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,code,form,fieldset,legend,input,button,textarea,p,blockquote,th,td { margin:0; padding:0; }
	    body { background:#fff; color:#555; font-size:14px; font-family: Verdana, Arial, Helvetica, sans-serif; }
	    td,th,caption { font-size:14px; }
	    h1, h2, h3, h4, h5, h6 { font-weight:normal; font-size:100%; }
	    address, caption, cite, code, dfn, em, strong, th, var { font-style:normal; font-weight:normal;}
	    a { color:#555; text-decoration:none; }
	    a:hover { text-decoration:underline; }
	    img { border:none; }
	    ol,ul,li { list-style:none; }
	    input, textarea, select, button { font:14px Verdana,Helvetica,Arial,sans-serif; }
	    table { border-collapse:collapse; }
	    html {overflow-y: scroll;}

	    .clearfix:after {content: "."; display: block; height:0; clear:both; visibility: hidden;}
	    .clearfix { *zoom:1; }
	</style>
	<script type="text/javascript">
		(function(win,doc,designWidth){

			var docEl = doc.documentElement,
				metaEl = doc.querySelector('meta[name="viewport"]'),
				dpr = 0,
				scale = 0,
				timer;

			if(metaEl){//根据已有meta的viewport来设置
				var matches = metaEl.getAttribute('content').match(/initial\-scale=([\d\.]+)/i);
				if(matches){
					scale = parseFloat(matches[1]);
					dpr = 1 / scale;
				}
			}

			if(!dpr && !scale){
				var appVersion = navigator.appVersion,
					isAndroid = /android/gi.test(appVersion),
					isIPhone = /iphone/gi.test(appVersion),
					devicePixelRatio = win.devicePixelRatio;

				if(isIPhone){//iphone设备

					if(devicePixelRatio >= 3 && (!dpr || dpr >= 3)){
						dpr = 3;
					}else if(devicePixelRatio >=2 && (!dpr || dpr >= 2)){
						dpr = 2;
					}else{
						dpr = 1;
					}

				}else{//android及其他设备
					dpr = 1;
				}
				scale = 1 / dpr;
			}

			docEl.setAttribute('data-dpr',dpr);
			if(!metaEl){
				metaEl = doc.createElement('meta');
				metaEl.setAttribute('name','viewport');
				metaEl.setAttribute('content','initial-scale=' + scale + ',minimum-scale=' + scale + ',maximum-scale=' + scale + ',user-scalable=no');
				if(docEl.firstElementChild){
					docEl.firstElementChild.appendChild(metaEl);
				}
			}

			win.addEventListener('resize',refreshRem,false);
			win.addEventListener('DOMContentLoaded',refreshRem,false);

			function refreshRem(){
				clearTimeout(timer);
				timer = setTimeout(function(){
					var rootWidth = Math.max(docEl.offsetWidth,docEl.clientWidth);
					if(rootWidth / dpr > 540){
						rootWidth = 540 * dpr;
					}
					var rem = rootWidth * 100 / designWidth;//跟元素fontSize放大了100倍，相应的设计稿元素px转换为rem要除以100
					docEl.style.fontSize = rem + 'px';
				},300);
			}

			win.addEventListener('unload',function(){
				win.removeEventListener('resize',refreshRem,false);
				win.removeEventListener('DOMContentLoaded',onPageShow,false)
			},false);

		})(window,document,750);//设计稿尺寸
	</script>
	<link rel="stylesheet" type="text/css" href="css/demo.css">
	<script type="text/javascript" src="../js/jCrop.js"></script>
</head>
<body>
	
	<div class="tips">
		<span>由于裁剪功能使用的是画布元素，所以只兼容至IE9+</span>
	</div>

	<div class="file-select">
		<input type="file" name="imgcut" accept="image/jpeg,image/jpg,image/png">
	</div>

	<!-- <div class="modal">
		<div class="view"></div>
		<div class="btns">
			<div class="btn reset">重置</div>
			<div class="btn sure">裁剪</div>
			<div class="btn zoom">放大</div>
			<div class="btn shrink">缩小</div>
			<div class="btn clockwise">顺时针旋转</div>
			<div class="btn counterclockwise">逆时针旋转</div>
		</div>
	</div> -->

	<script type="text/javascript">
		
		window.addEventListener('DOMContentLoaded',ready,false);
		function ready(){
			document.querySelector('.file-select input').addEventListener('change',fileSelect,false);
		}
		function fileSelect(e){
			var file = e.target,
				filePath = file.value,
				ext = filePath.substr(filePath.lastIndexOf('.') + 1).toLowerCase(),
				types = ['jpg','jpeg','png'];

			if(types.indexOf(ext) == -1){
				alert('图片格式错误');
				return ;
			}

			if(window.FileReader){//File Reader
				var reader = new FileReader();
				reader.onload = function(){
					preview(this.result);
				};
				reader.readAsDataURL(file.files[0]);
			}else if(document.all){//IE9
				file.select();
				file.blur();
				var reallocalpath = document.selection.createRange().text,
					img = new Image();

				img.style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='image',src=\"" + reallocalpath + "\")";
				img.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==';
				preview(img);
			}
		}

		function preview(imgOrSrc){
			console.log(imgOrSrc);
		}
		function logout(){
			window.removeEventListener('DOMContentLoaded',ready,false);
			document.querySelector('.file-select input').removeEventListener('change',fileSelect,false);
		}
		window.addEventListener('unload',logout,false);
	</script>

</body>
</html>